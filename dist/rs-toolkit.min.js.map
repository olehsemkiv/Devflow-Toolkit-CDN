{"version":3,"file":"rs-toolkit.min.js","sources":["../src/core.js","../src/modules/modal.js"],"sourcesContent":["// src/core.js\n(function () {\n  const RS = (window.RS = window.RS || {});\n\n  // basic meta\n  RS.version = RS.version || \"0.1.0\";\n  RS.modules = RS.modules || {}; // { modal: initFn, ... }\n\n  // debug flag: window.RS_DEBUG = true\n  RS.debug = function (...args) {\n    if (window.RS_DEBUG) console.log(\"[RS]\", ...args);\n  };\n\n  // basic event helper\n  RS.emit = function (name, detail = {}) {\n    document.dispatchEvent(new CustomEvent(name, { detail }));\n  };\n\n  // module registry\n  RS.register = function (name, initFn) {\n    if (!name || typeof initFn !== \"function\") return;\n    RS.modules[name] = initFn;\n    RS.debug(\"registered:\", name);\n  };\n\n  // init all registered modules\n  RS.init = function () {\n    RS.debug(\"init start\");\n    Object.entries(RS.modules).forEach(([name, initFn]) => {\n      try {\n        initFn();\n        RS.debug(\"init ok:\", name);\n      } catch (e) {\n        console.error(\"[RS] init failed:\", name, e);\n      }\n    });\n    RS.debug(\"init done\");\n  };\n\n  // NOTE: no auto-run here. Call window.RS.init() manually.\n})();\n","// src/modules/modal.js\n(function () {\n  if (!window.RS || !window.RS.register) {\n    console.warn(\"[RS] core is missing. Include rs-core.min.js first.\");\n    return;\n  }\n\n  const SELECTORS = {\n    modal: \"[data-rs-modal]\",\n    open: \"[data-rs-modal-open]\",\n    close: \"[data-rs-modal-close]\",\n    overlay: \"[data-rs-modal-overlay]\",\n    content: \"[data-rs-modal-content]\",\n  };\n\n\n  const STATE = {\n    open: \"is-open\",\n    htmlLocked: \"is-modal-open\",\n  };\n\n  // Escape helper\n  const cssEscape =\n    (window.CSS && CSS.escape) ||\n    function (str) {\n      return String(str).replace(/[\"\\\\#.:?[\\]()\\s]/g, \"\\\\$&\");\n    };\n\n  let activeModal = null;\n  let lastTrigger = null;\n\n  // scroll lock (only when modal has data-rs-modal-lock=\"true\")\n  const lockState = {\n    locked: false,\n    scrollY: 0,\n    prev: {},\n  };\n\n  function isTrue(val) {\n    const v = String(val || \"\").toLowerCase().trim();\n    return v === \"true\" || v === \"1\" || v === \"yes\";\n  }\n\n  function shouldLock(modal) {\n    if (!modal) return false;\n    // if attribute missing => DO NOT lock\n    if (!modal.hasAttribute(\"data-rs-modal-lock\")) return false;\n    return isTrue(modal.getAttribute(\"data-rs-modal-lock\"));\n  }\n\n  function lockScroll() {\n    if (lockState.locked) return;\n\n    const html = document.documentElement;\n    const body = document.body;\n\n    lockState.scrollY = window.scrollY || 0;\n\n    lockState.prev = {\n      htmlOverflow: html.style.overflow,\n      bodyPosition: body.style.position,\n      bodyTop: body.style.top,\n      bodyWidth: body.style.width,\n      bodyOverflow: body.style.overflow,\n    };\n\n    // iOS-safe lock: body fixed\n    body.style.position = \"fixed\";\n    body.style.top = `-${lockState.scrollY}px`;\n    body.style.width = \"100%\";\n    body.style.overflow = \"hidden\";\n    html.classList.add(STATE.htmlLocked);\n\n    lockState.locked = true;\n  }\n\n  function unlockScroll() {\n    if (!lockState.locked) return;\n\n    const html = document.documentElement;\n    const body = document.body;\n\n    body.style.position = lockState.prev.bodyPosition || \"\";\n    body.style.top = lockState.prev.bodyTop || \"\";\n    body.style.width = lockState.prev.bodyWidth || \"\";\n    body.style.overflow = lockState.prev.bodyOverflow || \"\";\n    html.style.overflow = lockState.prev.htmlOverflow || \"\";\n    html.classList.remove(STATE.htmlLocked);\n\n    window.scrollTo(0, lockState.scrollY);\n\n    lockState.locked = false;\n  }\n\n  function getFocusable(modal) {\n    if (!modal) return [];\n    const content = modal.querySelector(SELECTORS.content) || modal;\n    const nodes = content.querySelectorAll(\n      [\n        \"a[href]\",\n        \"button:not([disabled])\",\n        \"input:not([disabled])\",\n        \"select:not([disabled])\",\n        \"textarea:not([disabled])\",\n        \"[tabindex]:not([tabindex='-1'])\",\n      ].join(\",\")\n    );\n    return Array.from(nodes).filter((el) => el.offsetParent !== null);\n  }\n\n  function focusFirst(modal) {\n    const focusables = getFocusable(modal);\n    if (focusables.length) focusables[0].focus();\n    else modal.focus?.();\n  }\n\n  function trapTab(e, modal) {\n    if (e.key !== \"Tab\") return;\n    const focusables = getFocusable(modal);\n    if (!focusables.length) return;\n\n    const first = focusables[0];\n    const last = focusables[focusables.length - 1];\n    const active = document.activeElement;\n\n    if (e.shiftKey) {\n      if (active === first || active === modal) {\n        e.preventDefault();\n        last.focus();\n      }\n    } else {\n      if (active === last) {\n        e.preventDefault();\n        first.focus();\n      }\n    }\n  }\n\n  function findModalById(id) {\n    if (!id) return null;\n    return document.querySelector(`${SELECTORS.modal}[data-rs-modal=\"${cssEscape(id)}\"]`);\n  }\n\n  function closeModal(modal, reason = \"close\") {\n    if (!modal) return;\n\n    modal.classList.remove(STATE.open);\n    modal.setAttribute(\"aria-hidden\", \"true\");\n\n    if (shouldLock(modal)) unlockScroll();\n\n    const closedModalId = modal.getAttribute(\"data-rs-modal\") || null;\n    window.RS.emit(\"rs:modal:close\", { id: closedModalId, modal, reason });\n\n    // return focus\n    if (lastTrigger && typeof lastTrigger.focus === \"function\") {\n      lastTrigger.focus();\n    }\n\n    if (activeModal === modal) activeModal = null;\n    lastTrigger = null;\n  }\n\n  function openModal(modal, trigger = null) {\n    if (!modal) return;\n\n    // close currently opened modal (single-open policy)\n    if (activeModal && activeModal !== modal) {\n      closeModal(activeModal, \"switch\");\n    }\n\n    lastTrigger = trigger || null;\n    activeModal = modal;\n\n    modal.classList.add(STATE.open);\n    modal.setAttribute(\"aria-hidden\", \"false\");\n    modal.setAttribute(\"tabindex\", \"-1\");\n\n    if (shouldLock(modal)) lockScroll();\n\n    const openedModalId = modal.getAttribute(\"data-rs-modal\") || null;\n    window.RS.emit(\"rs:modal:open\", { id: openedModalId, modal, trigger });\n\n    // focus\n    setTimeout(() => focusFirst(modal), 0);\n  }\n\n  function getOpenTargetFromEl(el) {\n    // supports:\n    // data-rs-modal-open=\"signup\" (preferred)\n    // OR data-rs-modal-target=\"#modalId\" (fallback if you want)\n    const id = el.getAttribute(\"data-rs-modal-open\");\n    if (id) return { type: \"id\", value: id };\n\n    const sel = el.getAttribute(\"data-rs-modal-target\");\n    if (sel) return { type: \"selector\", value: sel };\n\n    return null;\n  }\n\n  function isFormControl(el) {\n    const tag = (el.tagName || \"\").toLowerCase();\n    return tag === \"input\" || tag === \"textarea\" || tag === \"select\";\n  }\n\n  function resolveModal(target) {\n    if (!target) return null;\n    if (target.type === \"id\") return findModalById(target.value);\n    if (target.type === \"selector\") return document.querySelector(target.value);\n    return null;\n  }\n\n  window.RS.register(\"modal\", function initModal() {\n    // CLICK open (delegation)\n    document.addEventListener(\"click\", (e) => {\n      const openEl = e.target.closest(SELECTORS.open);\n      if (openEl) {\n        e.preventDefault();\n\n        const target = getOpenTargetFromEl(openEl);\n        const modal = resolveModal(target);\n        if (modal) openModal(modal, openEl);\n        return;\n      }\n\n      // close button\n      const closeEl = e.target.closest(SELECTORS.close);\n      if (closeEl) {\n        const modal = closeEl.closest(SELECTORS.modal);\n        if (modal) closeModal(modal, \"button\");\n        return;\n      }\n\n      // overlay click\n      const overlayEl = e.target.closest(SELECTORS.overlay);\n      if (overlayEl) {\n        const modal = overlayEl.closest(SELECTORS.modal);\n        if (!modal) return;\n\n        // if user clicked inside content, ignore\n        const content = modal.querySelector(SELECTORS.content);\n        if (content && content.contains(e.target)) return;\n\n        closeModal(modal, \"overlay\");\n      }\n    });\n\n    // INPUT open on focus (for elements that have data-rs-modal-open and are form controls)\n    document.addEventListener(\"focusin\", (e) => {\n      const el = e.target;\n      if (!el || !el.matches?.(SELECTORS.open)) return;\n\n      // for inputs/selects/textareas open on focus\n      if (!isFormControl(el)) return;\n\n      const target = getOpenTargetFromEl(el);\n      const modal = resolveModal(target);\n      if (modal) openModal(modal, el);\n    });\n\n    // ESC + focus trap\n    document.addEventListener(\"keydown\", (e) => {\n      if (!activeModal) return;\n\n      if (e.key === \"Escape\") {\n        e.preventDefault();\n        closeModal(activeModal, \"escape\");\n        return;\n      }\n\n      trapTab(e, activeModal);\n    });\n  });\n})();\n"],"names":["RS","window","version","modules","debug","args","RS_DEBUG","console","log","emit","name","detail","document","dispatchEvent","CustomEvent","register","initFn","init","Object","entries","forEach","e","error","warn","SELECTORS","STATE","cssEscape","CSS","escape","str","String","replace","activeModal","lastTrigger","lockState","locked","scrollY","prev","shouldLock","modal","hasAttribute","val","v","toLowerCase","trim","isTrue","getAttribute","getFocusable","nodes","querySelector","querySelectorAll","join","Array","from","filter","el","offsetParent","closeModal","reason","classList","remove","setAttribute","html","documentElement","body","style","position","bodyPosition","top","bodyTop","width","bodyWidth","overflow","bodyOverflow","htmlOverflow","scrollTo","unlockScroll","closedModalId","id","focus","openModal","trigger","add","lockScroll","openedModalId","setTimeout","focusables","length","focusFirst","getOpenTargetFromEl","type","value","sel","resolveModal","target","addEventListener","openEl","closest","preventDefault","closeEl","overlayEl","content","contains","matches","tag","tagName","isFormControl","key","first","last","active","activeElement","shiftKey","trapTab"],"mappings":"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"}