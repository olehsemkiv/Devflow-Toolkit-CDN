{"version":3,"file":"rs-modal.min.js","sources":["../../src/modules/modal.js"],"sourcesContent":["// src/modules/modal.js\n(function () {\n  if (!window.RS || !window.RS.register) {\n    console.warn(\"[RS] core is missing. Include rs-core.min.js first.\");\n    return;\n  }\n\n  const SELECTORS = {\n    modal: \"[data-rs-modal]\",\n    open: \"[data-rs-modal-open]\",\n    close: \"[data-rs-modal-close]\",\n    overlay: \"[data-rs-modal-overlay]\",\n    content: \"[data-rs-modal-content]\",\n  };\n\n\n  const STATE = {\n    open: \"is-open\",\n    htmlLocked: \"is-modal-open\",\n  };\n\n  // Escape helper\n  const cssEscape =\n    (window.CSS && CSS.escape) ||\n    function (str) {\n      return String(str).replace(/[\"\\\\#.:?[\\]()\\s]/g, \"\\\\$&\");\n    };\n\n  let activeModal = null;\n  let lastTrigger = null;\n\n  // scroll lock (only when modal has data-rs-modal-lock=\"true\")\n  const lockState = {\n    locked: false,\n    scrollY: 0,\n    prev: {},\n  };\n\n  function isTrue(val) {\n    const v = String(val || \"\").toLowerCase().trim();\n    return v === \"true\" || v === \"1\" || v === \"yes\";\n  }\n\n  function shouldLock(modal) {\n    if (!modal) return false;\n    // if attribute missing => DO NOT lock\n    if (!modal.hasAttribute(\"data-rs-modal-lock\")) return false;\n    return isTrue(modal.getAttribute(\"data-rs-modal-lock\"));\n  }\n\n  function lockScroll() {\n    if (lockState.locked) return;\n\n    const html = document.documentElement;\n    const body = document.body;\n\n    lockState.scrollY = window.scrollY || 0;\n\n    lockState.prev = {\n      htmlOverflow: html.style.overflow,\n      bodyPosition: body.style.position,\n      bodyTop: body.style.top,\n      bodyWidth: body.style.width,\n      bodyOverflow: body.style.overflow,\n    };\n\n    // iOS-safe lock: body fixed\n    body.style.position = \"fixed\";\n    body.style.top = `-${lockState.scrollY}px`;\n    body.style.width = \"100%\";\n    body.style.overflow = \"hidden\";\n    html.classList.add(STATE.htmlLocked);\n\n    lockState.locked = true;\n  }\n\n  function unlockScroll() {\n    if (!lockState.locked) return;\n\n    const html = document.documentElement;\n    const body = document.body;\n\n    body.style.position = lockState.prev.bodyPosition || \"\";\n    body.style.top = lockState.prev.bodyTop || \"\";\n    body.style.width = lockState.prev.bodyWidth || \"\";\n    body.style.overflow = lockState.prev.bodyOverflow || \"\";\n    html.style.overflow = lockState.prev.htmlOverflow || \"\";\n    html.classList.remove(STATE.htmlLocked);\n\n    window.scrollTo(0, lockState.scrollY);\n\n    lockState.locked = false;\n  }\n\n  function getFocusable(modal) {\n    if (!modal) return [];\n    const content = modal.querySelector(SELECTORS.content) || modal;\n    const nodes = content.querySelectorAll(\n      [\n        \"a[href]\",\n        \"button:not([disabled])\",\n        \"input:not([disabled])\",\n        \"select:not([disabled])\",\n        \"textarea:not([disabled])\",\n        \"[tabindex]:not([tabindex='-1'])\",\n      ].join(\",\")\n    );\n    return Array.from(nodes).filter((el) => el.offsetParent !== null);\n  }\n\n  function focusFirst(modal) {\n    const focusables = getFocusable(modal);\n    if (focusables.length) focusables[0].focus();\n    else modal.focus?.();\n  }\n\n  function trapTab(e, modal) {\n    if (e.key !== \"Tab\") return;\n    const focusables = getFocusable(modal);\n    if (!focusables.length) return;\n\n    const first = focusables[0];\n    const last = focusables[focusables.length - 1];\n    const active = document.activeElement;\n\n    if (e.shiftKey) {\n      if (active === first || active === modal) {\n        e.preventDefault();\n        last.focus();\n      }\n    } else {\n      if (active === last) {\n        e.preventDefault();\n        first.focus();\n      }\n    }\n  }\n\n  function findModalById(id) {\n    if (!id) return null;\n    return document.querySelector(`${SELECTORS.modal}[data-rs-modal=\"${cssEscape(id)}\"]`);\n  }\n\n  function closeModal(modal, reason = \"close\") {\n    if (!modal) return;\n\n    modal.classList.remove(STATE.open);\n    modal.setAttribute(\"aria-hidden\", \"true\");\n\n    if (shouldLock(modal)) unlockScroll();\n\n    const closedModalId = modal.getAttribute(\"data-rs-modal\") || null;\n    window.RS.emit(\"rs:modal:close\", { id: closedModalId, modal, reason });\n\n    // return focus\n    if (lastTrigger && typeof lastTrigger.focus === \"function\") {\n      lastTrigger.focus();\n    }\n\n    if (activeModal === modal) activeModal = null;\n    lastTrigger = null;\n  }\n\n  function openModal(modal, trigger = null) {\n    if (!modal) return;\n\n    // close currently opened modal (single-open policy)\n    if (activeModal && activeModal !== modal) {\n      closeModal(activeModal, \"switch\");\n    }\n\n    lastTrigger = trigger || null;\n    activeModal = modal;\n\n    modal.classList.add(STATE.open);\n    modal.setAttribute(\"aria-hidden\", \"false\");\n    modal.setAttribute(\"tabindex\", \"-1\");\n\n    if (shouldLock(modal)) lockScroll();\n\n    const openedModalId = modal.getAttribute(\"data-rs-modal\") || null;\n    window.RS.emit(\"rs:modal:open\", { id: openedModalId, modal, trigger });\n\n    // focus\n    setTimeout(() => focusFirst(modal), 0);\n  }\n\n  function getOpenTargetFromEl(el) {\n    // supports:\n    // data-rs-modal-open=\"signup\" (preferred)\n    // OR data-rs-modal-target=\"#modalId\" (fallback if you want)\n    const id = el.getAttribute(\"data-rs-modal-open\");\n    if (id) return { type: \"id\", value: id };\n\n    const sel = el.getAttribute(\"data-rs-modal-target\");\n    if (sel) return { type: \"selector\", value: sel };\n\n    return null;\n  }\n\n  function isFormControl(el) {\n    const tag = (el.tagName || \"\").toLowerCase();\n    return tag === \"input\" || tag === \"textarea\" || tag === \"select\";\n  }\n\n  function resolveModal(target) {\n    if (!target) return null;\n    if (target.type === \"id\") return findModalById(target.value);\n    if (target.type === \"selector\") return document.querySelector(target.value);\n    return null;\n  }\n\n  window.RS.register(\"modal\", function initModal() {\n    // CLICK open (delegation)\n    document.addEventListener(\"click\", (e) => {\n      const openEl = e.target.closest(SELECTORS.open);\n      if (openEl) {\n        e.preventDefault();\n\n        const target = getOpenTargetFromEl(openEl);\n        const modal = resolveModal(target);\n        if (modal) openModal(modal, openEl);\n        return;\n      }\n\n      // close button\n      const closeEl = e.target.closest(SELECTORS.close);\n      if (closeEl) {\n        const modal = closeEl.closest(SELECTORS.modal);\n        if (modal) closeModal(modal, \"button\");\n        return;\n      }\n\n      // overlay click\n      const overlayEl = e.target.closest(SELECTORS.overlay);\n      if (overlayEl) {\n        const modal = overlayEl.closest(SELECTORS.modal);\n        if (!modal) return;\n\n        // if user clicked inside content, ignore\n        const content = modal.querySelector(SELECTORS.content);\n        if (content && content.contains(e.target)) return;\n\n        closeModal(modal, \"overlay\");\n      }\n    });\n\n    // INPUT open on focus (for elements that have data-rs-modal-open and are form controls)\n    document.addEventListener(\"focusin\", (e) => {\n      const el = e.target;\n      if (!el || !el.matches?.(SELECTORS.open)) return;\n\n      // for inputs/selects/textareas open on focus\n      if (!isFormControl(el)) return;\n\n      const target = getOpenTargetFromEl(el);\n      const modal = resolveModal(target);\n      if (modal) openModal(modal, el);\n    });\n\n    // ESC + focus trap\n    document.addEventListener(\"keydown\", (e) => {\n      if (!activeModal) return;\n\n      if (e.key === \"Escape\") {\n        e.preventDefault();\n        closeModal(activeModal, \"escape\");\n        return;\n      }\n\n      trapTab(e, activeModal);\n    });\n  });\n})();\n"],"names":["window","RS","register","console","warn","SELECTORS","STATE","cssEscape","CSS","escape","str","String","replace","activeModal","lastTrigger","lockState","locked","scrollY","prev","shouldLock","modal","hasAttribute","val","v","toLowerCase","trim","isTrue","getAttribute","getFocusable","nodes","querySelector","querySelectorAll","join","Array","from","filter","el","offsetParent","closeModal","reason","classList","remove","setAttribute","html","document","documentElement","body","style","position","bodyPosition","top","bodyTop","width","bodyWidth","overflow","bodyOverflow","htmlOverflow","scrollTo","unlockScroll","closedModalId","emit","id","focus","openModal","trigger","add","lockScroll","openedModalId","setTimeout","focusables","length","focusFirst","getOpenTargetFromEl","type","value","sel","resolveModal","target","addEventListener","e","openEl","closest","preventDefault","closeEl","overlayEl","content","contains","matches","tag","tagName","isFormControl","key","first","last","active","activeElement","shiftKey","trapTab"],"mappings":"0BACA,WACE,IAAKA,OAAOC,KAAOD,OAAOC,GAAGC,SAE3B,YADAC,QAAQC,KAAK,uDAIf,MAAMC,EACG,kBADHA,EAEE,uBAFFA,EAGG,wBAHHA,EAIK,0BAJLA,EAKK,0BAILC,EACE,UADFA,EAEQ,gBAIRC,EACHP,OAAOQ,KAAOA,IAAIC,QACnB,SAAUC,GACR,OAAOC,OAAOD,GAAKE,QAAQ,oBAAqB,OAClD,EAEF,IAAIC,EAAc,KACdC,EAAc,KAGlB,MAAMC,EAAY,CAChBC,QAAQ,EACRC,QAAS,EACTC,KAAM,CAAA,GAQR,SAASC,EAAWC,GAClB,QAAKA,MAEAA,EAAMC,aAAa,uBAR1B,SAAgBC,GACd,MAAMC,EAAIZ,OAAOW,GAAO,IAAIE,cAAcC,OAC1C,MAAa,SAANF,GAAsB,MAANA,GAAmB,QAANA,CACtC,CAMSG,CAAON,EAAMO,aAAa,uBACnC,CA8CA,SAASC,EAAaR,GACpB,IAAKA,EAAO,MAAO,GACnB,MACMS,GADUT,EAAMU,cAAczB,IAAsBe,GACpCW,iBACpB,CACE,UACA,yBACA,wBACA,yBACA,2BACA,mCACAC,KAAK,MAET,OAAOC,MAAMC,KAAKL,GAAOM,OAAQC,GAA2B,OAApBA,EAAGC,aAC7C,CAmCA,SAASC,EAAWlB,EAAOmB,EAAS,SAClC,IAAKnB,EAAO,OAEZA,EAAMoB,UAAUC,OAAOnC,GACvBc,EAAMsB,aAAa,cAAe,QAE9BvB,EAAWC,IAzEjB,WACE,IAAKL,EAAUC,OAAQ,OAEvB,MAAM2B,EAAOC,SAASC,gBAChBC,EAAOF,SAASE,KAEtBA,EAAKC,MAAMC,SAAWjC,EAAUG,KAAK+B,cAAgB,GACrDH,EAAKC,MAAMG,IAAMnC,EAAUG,KAAKiC,SAAW,GAC3CL,EAAKC,MAAMK,MAAQrC,EAAUG,KAAKmC,WAAa,GAC/CP,EAAKC,MAAMO,SAAWvC,EAAUG,KAAKqC,cAAgB,GACrDZ,EAAKI,MAAMO,SAAWvC,EAAUG,KAAKsC,cAAgB,GACrDb,EAAKH,UAAUC,OAAOnC,GAEtBN,OAAOyD,SAAS,EAAG1C,EAAUE,SAE7BF,EAAUC,QAAS,CACrB,CAyDyB0C,GAEvB,MAAMC,EAAgBvC,EAAMO,aAAa,kBAAoB,KAC7D3B,OAAOC,GAAG2D,KAAK,iBAAkB,CAAEC,GAAIF,EAAevC,QAAOmB,WAGzDzB,GAA4C,mBAAtBA,EAAYgD,OACpChD,EAAYgD,QAGVjD,IAAgBO,IAAOP,EAAc,MACzCC,EAAc,IAChB,CAEA,SAASiD,EAAU3C,EAAO4C,EAAU,MAClC,IAAK5C,EAAO,OAGRP,GAAeA,IAAgBO,GACjCkB,EAAWzB,EAAa,UAG1BC,EAAckD,GAAW,KACzBnD,EAAcO,EAEdA,EAAMoB,UAAUyB,IAAI3D,GACpBc,EAAMsB,aAAa,cAAe,SAClCtB,EAAMsB,aAAa,WAAY,MAE3BvB,EAAWC,IAhIjB,WACE,GAAIL,EAAUC,OAAQ,OAEtB,MAAM2B,EAAOC,SAASC,gBAChBC,EAAOF,SAASE,KAEtB/B,EAAUE,QAAUjB,OAAOiB,SAAW,EAEtCF,EAAUG,KAAO,CACfsC,aAAcb,EAAKI,MAAMO,SACzBL,aAAcH,EAAKC,MAAMC,SACzBG,QAASL,EAAKC,MAAMG,IACpBG,UAAWP,EAAKC,MAAMK,MACtBG,aAAcT,EAAKC,MAAMO,UAI3BR,EAAKC,MAAMC,SAAW,QACtBF,EAAKC,MAAMG,IAAM,IAAInC,EAAUE,YAC/B6B,EAAKC,MAAMK,MAAQ,OACnBN,EAAKC,MAAMO,SAAW,SACtBX,EAAKH,UAAUyB,IAAI3D,GAEnBS,EAAUC,QAAS,CACrB,CAwGyBkD,GAEvB,MAAMC,EAAgB/C,EAAMO,aAAa,kBAAoB,KAC7D3B,OAAOC,GAAG2D,KAAK,gBAAiB,CAAEC,GAAIM,EAAe/C,QAAO4C,YAG5DI,WAAW,IA1Eb,SAAoBhD,GAClB,MAAMiD,EAAazC,EAAaR,GAC5BiD,EAAWC,OAAQD,EAAW,GAAGP,QAChC1C,EAAM0C,SACb,CAsEmBS,CAAWnD,GAAQ,EACtC,CAEA,SAASoD,EAAoBpC,GAI3B,MAAMyB,EAAKzB,EAAGT,aAAa,sBAC3B,GAAIkC,EAAI,MAAO,CAAEY,KAAM,KAAMC,MAAOb,GAEpC,MAAMc,EAAMvC,EAAGT,aAAa,wBAC5B,OAAIgD,EAAY,CAAEF,KAAM,WAAYC,MAAOC,GAEpC,IACT,CAOA,SAASC,EAAaC,GACpB,OAAKA,EACe,OAAhBA,EAAOJ,MArEUZ,EAqE0BgB,EAAOH,OAnE/C9B,SAASd,cAAc,GAAGzB,oBAAkCE,EAAUsD,QAD7D,KAqEI,aAAhBgB,EAAOJ,KAA4B7B,SAASd,cAAc+C,EAAOH,OAC9D,KAHa,KApEtB,IAAuBb,CAwEvB,CAEA7D,OAAOC,GAAGC,SAAS,QAAS,WAE1B0C,SAASkC,iBAAiB,QAAUC,IAClC,MAAMC,EAASD,EAAEF,OAAOI,QAAQ5E,GAChC,GAAI2E,EAAQ,CACVD,EAAEG,iBAEF,MACM9D,EAAQwD,EADCJ,EAAoBQ,IAGnC,YADI5D,GAAO2C,EAAU3C,EAAO4D,GAE9B,CAGA,MAAMG,EAAUJ,EAAEF,OAAOI,QAAQ5E,GACjC,GAAI8E,EAAS,CACX,MAAM/D,EAAQ+D,EAAQF,QAAQ5E,GAE9B,YADIe,GAAOkB,EAAWlB,EAAO,UAE/B,CAGA,MAAMgE,EAAYL,EAAEF,OAAOI,QAAQ5E,GACnC,GAAI+E,EAAW,CACb,MAAMhE,EAAQgE,EAAUH,QAAQ5E,GAChC,IAAKe,EAAO,OAGZ,MAAMiE,EAAUjE,EAAMU,cAAczB,GACpC,GAAIgF,GAAWA,EAAQC,SAASP,EAAEF,QAAS,OAE3CvC,EAAWlB,EAAO,UACpB,IAIFwB,SAASkC,iBAAiB,UAAYC,IACpC,MAAM3C,EAAK2C,EAAEF,OACb,IAAKzC,IAAOA,EAAGmD,UAAUlF,GAAiB,OAG1C,IArDJ,SAAuB+B,GACrB,MAAMoD,GAAOpD,EAAGqD,SAAW,IAAIjE,cAC/B,MAAe,UAARgE,GAA2B,aAARA,GAA8B,WAARA,CAClD,CAkDSE,CAActD,GAAK,OAExB,MACMhB,EAAQwD,EADCJ,EAAoBpC,IAE/BhB,GAAO2C,EAAU3C,EAAOgB,KAI9BQ,SAASkC,iBAAiB,UAAYC,IACpC,GAAKlE,EAEL,MAAc,WAAVkE,EAAEY,KACJZ,EAAEG,sBACF5C,EAAWzB,EAAa,gBAtJ9B,SAAiBkE,EAAG3D,GAClB,GAAc,QAAV2D,EAAEY,IAAe,OACrB,MAAMtB,EAAazC,EAAaR,GAChC,IAAKiD,EAAWC,OAAQ,OAExB,MAAMsB,EAAQvB,EAAW,GACnBwB,EAAOxB,EAAWA,EAAWC,OAAS,GACtCwB,EAASlD,SAASmD,cAEpBhB,EAAEiB,SACAF,IAAWF,GAASE,IAAW1E,IACjC2D,EAAEG,iBACFW,EAAK/B,SAGHgC,IAAWD,IACbd,EAAEG,iBACFU,EAAM9B,QAGZ,CAsIImC,CAAQlB,EAAGlE,IAEf,EACD,CAhRD"}